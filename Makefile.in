EXE=supagrep$(EXTENSION)
PACKAGE=supagrep
DIST=$(PACKAGE)-$(VERSION)

all: $(EXE)

tools/libtools.a:
	cd tools && gmake

cpputils/io/libcpputilsio.a:
	cd cpputils/io && gmake
		
cpputils/cpputilsshared/cpputilsshared.a:
	cd cpputils/cpputilsshared && gmake
	
cpputils/cpputilsshared/cpputilsformat.a:
	cd 	cpputils/cpputilsshared/cpputilsformat && gmake

$(EXE): $(OFILES) tools/libtools.a \
	cpputils/io/libcpputilsio.a \
	cpputils/cpputilsshared/cpputilsshared.a \
	cpputils/cpputilsshared/cpputilsformat.a
	$(CXX) -o $(EXE) $(CXXFLAGS) $(OFILES) $(LDFLAGS) -lcpputilsformat -lcpputilsio -lcpputilsshared tools/libtools.a

clean_tools:
	cd tools && gmake clean
	cd cpputils/cpputilsshared && gmake clean
	cd cpputils/io && gmake clean
	cd cpputils/cpputilsshared/cpputilsformat && gmake clean
	

dist: clean clean_tools
	rm -rf $(DIST)
	rm -f $(DIST).tar.gz
	mkdir $(DIST)
	cp -r tools $(DIST)
	cp $(CFILES) $(HFILES) COPYING genmak configure Makefile.in $(DIST)
	find $(DIST) -name "CVS" | xargs rm -rf
	chmod -R u+w  $(DIST)
	tar cvf $(DIST).tar $(DIST)
	gzip --best $(DIST).tar
	rm -rf $(DIST)
